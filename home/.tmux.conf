# ==================================================
# General Setup
# ==================================================

# Set the default terminal to enable 256-color support.
set -g default-terminal "tmux-256color"
# Enable RGB color capabilities for compatible terminals (like ghostty).
set-option -sa terminal-features ',xterm-256color:RGB'

# Reduce the delay between pressing escape and tmux recognizing it.
set -s escape-time 0

# Allow passthrough of special escape sequences for features like italics.
set-option -g allow-passthrough on

# Enable mouse support for scrolling, pane selection, etc.
set -g mouse on

# Use vi-style keybindings in copy mode.
setw -g mode-keys vi

# Automatically renumber windows when one is closed to avoid gaps.
set-option -g renumber-windows on

# Allow tmux to copy to the system clipboard.
set -s set-clipboard on


# ==================================================
# Keybindings
# ==================================================

# --- Pane Management ---
# Split panes using | (vertical) and - (horizontal).
bind | split-window -h
bind - split-window -v
unbind '"'
unbind %

# --- Scripts & Commands ---
# Open lazygit in a new window.
bind G new-window -n 'lazygit' lazygit

# Open a fuzzy-finding sessionizer script.
bind-key f run-shell "tmux neww ~/.config/scripts/tmux-sessionizer.sh"

# Open the sessionizer script scoped to the ~/Projects directory.
bind-key -r P run-shell "~/.config/scripts/tmux-sessionizer.sh ~/Projects"

# --- Copy Mode (Vi) ---
# Use 'v' to begin selection, 'V' to select line, and 'y' to copy to clipboard.
bind-key -T copy-mode-vi v send -X begin-selection
bind-key -T copy-mode-vi V send -X select-line
bind-key -T copy-mode-vi y send -X copy-pipe-and-cancel "pbcopy"

# ==================================================
# Display pop-ups windows
# ==================================================
bind C-i display-popup \
  -d "#{pane_current_path}" \
  -w 80% \
  -h 80% \
  -E "jj ci -i"
bind C-d display-popup \
  -d "#{pane_current_path}" \
  -w 80% \
  -h 80% \
  -E "jj diff"
bind C-n display-popup -E 'bash -i -c "read -p \"Session name: \" name; tmux new-session -d -s \$name && tmux switch-client -t \$name"'
bind C-j display-popup -E "tmux list-sessions | sed -E 's/:.*$//' | grep -v \"^$(tmux display-message -p '#S')\$\" | fzf --reverse | xargs tmux switch-client -t"
bind C-t display-popup \
  -d "#{pane_current_path}" \
  -w 90% \
  -h 90% \
  -E "zsh"

# ==================================================
# Appearance (Ash Theme)
# ==================================================
# Note: 'default' for background colors makes them transparent.

# --- Status Bar ---
# Position the status bar at the top.
set -g status-position top
# Center the window list.
set -g status-justify absolute-centre
# Main status bar style (fg: text, bg: transparent).
set -g status-style 'fg=#d0d0d0 bg=default'

# Left status bar: show session name.
set -g status-left '#S'
set -g status-left-style 'fg=#a0a0a0'
set -g status-left-length 80

# Right status bar: empty by default.
set -g status-right ''
# (Optional) Uncomment to show time: set -g status-right '%H:%M'
set -g status-right-style 'fg=#d0d0d0'
set -g status-right-length 80

# --- Window List ---
# Format for the currently active window.
setw -g window-status-current-format '#I:#W '
# Style for the active window (bright white, bold).
setw -g window-status-current-style 'fg=#e8e8e8 bg=default bold'

# Format for inactive windows.
setw -g window-status-format '#I:#W '
# Style for inactive windows (dimmed gray).
setw -g window-status-style 'fg=#808080 bg=default'

# --- Pane Borders ---
# Style for inactive pane borders.
set -g pane-border-style 'fg=#303030'
# Style for the active pane border.
set -g pane-active-border-style 'fg=#585858'

# --- Command/Message Line ---
# Style for the tmux command prompt and messages.
set -g message-style 'fg=#e8e8e8 bg=#303030'

# Start windows and panes at 1, not 0
set -g base-index 1
setw -g pane-base-index 1

# ==================================================
# Plugins
# ==================================================

# Sensible default tmux options.
set -g @plugin 'tmux-plugins/tmux-sensible'
# Fuzzy searching with fzf.
set -g @plugin 'sainnhe/tmux-fzf'
# Yanking/copying utilities.
set -g @plugin 'tmux-plugins/tmux-yank'
# Enhance tmux navigation.
set -g @plugin 'christoomey/vim-tmux-navigator'

# Initialize TMUX plugin manager (keep this line at the very bottom of tmux.conf)
run -b '~/.config/tmux/plugins/tpm/tpm'
